<div class="help-popover"
     @onmouseenter="Open"
     @onmouseleave="Close"
     @onfocusin="Open"
     @onfocusout="Close">

    <button type="button"
            class="@ButtonClass"
            aria-label="@AriaLabel"
            aria-haspopup="true"
            aria-expanded="@_isOpen"
            @onclick="Toggle"
            @onkeydown="HandleKeyDown">
        @if (!string.IsNullOrWhiteSpace(Icon))
        {
            <span class="material-symbols-outlined">@Icon</span>
        }
        else
        {
            @ButtonText
        }
    </button>

    @if (_isOpen)
    {
        <div class="help-popover__panel" role="tooltip">
            @ChildContent
        </div>
    }
</div>

@code {
    private bool _isOpen;

    [Parameter] public string Icon { get; set; } = "help_outline";
    [Parameter] public string ButtonText { get; set; } = "?";
    [Parameter] public string AriaLabel { get; set; } = "Help";
    [Parameter] public string ButtonClass { get; set; } = "icon-btn";
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private void Open() => _isOpen = true;
    private void Close() => _isOpen = false;
    private void Toggle() => _isOpen = !_isOpen;

    private void HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key is "Escape")
            _isOpen = false;
    }
}